<Window x:Class="CompendiumMapCreator.MainWindow"
		xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
		xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
		xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
		xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
		xmlns:local="clr-namespace:CompendiumMapCreator"
		xmlns:vm="clr-namespace:CompendiumMapCreator.ViewModel"
		mc:Ignorable="d"
		Title="{Binding ProjectFile, UpdateSourceTrigger=PropertyChanged}" Height="730" Width="1024" KeyDown="Window_KeyDown">
	<Window.DataContext>
		<vm:MainWindow />
	</Window.DataContext>

	<Window.Resources>
		<ControlTemplate x:Key="imageButton" TargetType="{x:Type RadioButton}">
			<Grid Height="34">
				<Grid.Resources>
					<local:IconTypeToFileConverter x:Key="IconTypeToFile" />
				</Grid.Resources>
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="34" />
					<ColumnDefinition />
				</Grid.ColumnDefinitions>
				<Grid.RowDefinitions>
					<RowDefinition Height="34" />
				</Grid.RowDefinitions>

				<VisualStateManager.VisualStateGroups>
					<VisualStateGroup x:Name="CommonStates">
						<VisualState x:Name="Normal" />
						<VisualState x:Name="MouseOver">
							<Storyboard>
								<ColorAnimationUsingKeyFrames Storyboard.TargetName="Hover" Storyboard.TargetProperty="Fill.Color">
									<DiscreteColorKeyFrame KeyTime="0" Value="#C4C4C4" />
								</ColorAnimationUsingKeyFrames>
							</Storyboard>
						</VisualState>
					</VisualStateGroup>
					<VisualStateGroup x:Name="CheckStates">
						<VisualState x:Name="Checked">
							<Storyboard>
								<DoubleAnimationUsingKeyFrames Storyboard.TargetName="Image" Storyboard.TargetProperty="Opacity">
									<DiscreteDoubleKeyFrame KeyTime="0" Value="1" />
								</DoubleAnimationUsingKeyFrames>
							</Storyboard>
						</VisualState>
						<VisualState x:Name="Unchecked" />
					</VisualStateGroup>
				</VisualStateManager.VisualStateGroups>

				<Rectangle Name="Hover" Margin="4" Fill="#00000000" />
				<Image Name="Image" Source="{Binding Path=(local:Extensions.Source), RelativeSource={RelativeSource AncestorType={x:Type RadioButton}}}" Opacity="0.5" SnapsToDevicePixels="True" Margin="4" />

				<ContentPresenter Grid.Column="1" VerticalAlignment="Center" />
			</Grid>
		</ControlTemplate>

		<local:EnumBooleanConverter x:Key="EnumBooleanConverter" />
		<local:BoolToBrushConverter x:Key="BoolToBrushConverter" IsFalse="Transparent" IsTrue="#7F87CEFA" />
		<local:AddConverter x:Key="AddOne" Value="2" />
	</Window.Resources>

	<Grid>
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="150" />
			<ColumnDefinition />
		</Grid.ColumnDefinitions>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto" />
			<RowDefinition Height="Auto" />
			<RowDefinition />
			<RowDefinition Height="Auto" />
		</Grid.RowDefinitions>

		<Menu Grid.Row="0" Grid.ColumnSpan="2" Height="20">
			<MenuItem Header="File">
				<MenuItem Header="Save Project" Click="SaveProject_Click" />
				<MenuItem Header="Load Project" Click="LoadProject_Click" />
			</MenuItem>
			<MenuItem Header="Options">
				<MenuItem Header="Add Legend" IsCheckable="True" IsChecked="{Binding AddLegend}" />
			</MenuItem>
		</Menu>

		<Button Grid.Row="1" Height="40" Content="New" Margin="10" Focusable="False" Click="LoadImage" />

		<ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
			<StackPanel>
				<RadioButton Focusable="False" IsChecked="{Binding IconType, Converter={StaticResource EnumBooleanConverter}, ConverterParameter={x:Static local:IconType.None}}" local:Extensions.Source="/Icons/cursor.png" Template="{StaticResource imageButton}" Content="Cursor" GroupName="Selection" RenderOptions.BitmapScalingMode="Linear" />
				<RadioButton Focusable="False" IsChecked="{Binding IconType, Converter={StaticResource EnumBooleanConverter}, ConverterParameter={x:Static local:IconType.NormalChest}}" local:Extensions.Source="/Icons/normalChest.png" Template="{StaticResource imageButton}" Content="Normal Chest" GroupName="Selection" RenderOptions.BitmapScalingMode="NearestNeighbor" />
				<RadioButton Focusable="False" IsChecked="{Binding IconType, Converter={StaticResource EnumBooleanConverter}, ConverterParameter={x:Static local:IconType.TrappedChest}}" local:Extensions.Source="/Icons/trappedChest.png" Template="{StaticResource imageButton}" Content="Trapped Chest" GroupName="Selection" RenderOptions.BitmapScalingMode="NearestNeighbor" />
				<RadioButton Focusable="False" IsChecked="{Binding IconType, Converter={StaticResource EnumBooleanConverter}, ConverterParameter={x:Static local:IconType.LockedChest}}" local:Extensions.Source="/Icons/lockedChest.png" Template="{StaticResource imageButton}"  Content="Locked Chest" GroupName="Selection" RenderOptions.BitmapScalingMode="NearestNeighbor" />
				<RadioButton Focusable="False" IsChecked="{Binding IconType, Converter={StaticResource EnumBooleanConverter}, ConverterParameter={x:Static local:IconType.LockedDoor}}" local:Extensions.Source="/Icons/lockedDoor.png" Template="{StaticResource imageButton}" Content="Locked Door" GroupName="Selection" RenderOptions.BitmapScalingMode="NearestNeighbor" />
				<RadioButton Focusable="False" IsChecked="{Binding IconType, Converter={StaticResource EnumBooleanConverter}, ConverterParameter={x:Static local:IconType.LeverValveRune}}" local:Extensions.Source="/Icons/leverValve.png" Template="{StaticResource imageButton}" Content="Lever/Valve/Rune" GroupName="Selection" RenderOptions.BitmapScalingMode="NearestNeighbor" />
				<RadioButton Focusable="False" IsChecked="{Binding IconType, Converter={StaticResource EnumBooleanConverter}, ConverterParameter={x:Static local:IconType.ControlBox}}" local:Extensions.Source="/Icons/controlBox.png" Template="{StaticResource imageButton}" Content="Control Box" GroupName="Selection" RenderOptions.BitmapScalingMode="NearestNeighbor" />
				<RadioButton Focusable="False" IsChecked="{Binding IconType, Converter={StaticResource EnumBooleanConverter}, ConverterParameter={x:Static local:IconType.Collectible}}" local:Extensions.Source="/Icons/collectible.png" Template="{StaticResource imageButton}"  Content="Collectible" GroupName="Selection" RenderOptions.BitmapScalingMode="NearestNeighbor" />
				<RadioButton Focusable="False" IsChecked="{Binding IconType, Converter={StaticResource EnumBooleanConverter}, ConverterParameter={x:Static local:IconType.QuestItem}}" local:Extensions.Source="/Icons/questItem.png" Template="{StaticResource imageButton}"  Content="Quest Item" GroupName="Selection" RenderOptions.BitmapScalingMode="NearestNeighbor" />
				<RadioButton Focusable="False" IsChecked="{Binding IconType, Converter={StaticResource EnumBooleanConverter}, ConverterParameter={x:Static local:IconType.QuestNPC}}" local:Extensions.Source="/Icons/questNPC.png" Template="{StaticResource imageButton}"  Content="Quest NPC" GroupName="Selection" RenderOptions.BitmapScalingMode="NearestNeighbor" />
				<RadioButton Focusable="False" IsChecked="{Binding IconType, Converter={StaticResource EnumBooleanConverter}, ConverterParameter={x:Static local:IconType.SecretDoor}}" local:Extensions.Source="/Icons/secretDoor.png" Template="{StaticResource imageButton}"  Content="Secret Door" GroupName="Selection" RenderOptions.BitmapScalingMode="NearestNeighbor" />
				<RadioButton Focusable="False" IsChecked="{Binding IconType, Converter={StaticResource EnumBooleanConverter}, ConverterParameter={x:Static local:IconType.QuestExit}}" local:Extensions.Source="/Icons/questExit.png" Template="{StaticResource imageButton}"  Content="Quest Exit" GroupName="Selection" RenderOptions.BitmapScalingMode="NearestNeighbor" />
				<RadioButton Focusable="False" IsChecked="{Binding IconType, Converter={StaticResource EnumBooleanConverter}, ConverterParameter={x:Static local:IconType.Portal1}}" local:Extensions.Source="/Icons/portal1.png" Template="{StaticResource imageButton}"  Content="Waypoint/Portal 1" GroupName="Selection" RenderOptions.BitmapScalingMode="NearestNeighbor" />
				<RadioButton Focusable="False" IsChecked="{Binding IconType, Converter={StaticResource EnumBooleanConverter}, ConverterParameter={x:Static local:IconType.Portal2}}" local:Extensions.Source="/Icons/portal2.png" Template="{StaticResource imageButton}"  Content="Waypoint/Portal 2" GroupName="Selection" RenderOptions.BitmapScalingMode="NearestNeighbor" />
				<RadioButton Focusable="False" IsChecked="{Binding IconType, Converter={StaticResource EnumBooleanConverter}, ConverterParameter={x:Static local:IconType.Portal3}}" local:Extensions.Source="/Icons/portal3.png" Template="{StaticResource imageButton}"  Content="Waypoint/Portal 3" GroupName="Selection" RenderOptions.BitmapScalingMode="NearestNeighbor" />
				<RadioButton Focusable="False" IsChecked="{Binding IconType, Converter={StaticResource EnumBooleanConverter}, ConverterParameter={x:Static local:IconType.Portal4}}" local:Extensions.Source="/Icons/portal4.png" Template="{StaticResource imageButton}"  Content="Waypoint/Portal 4" GroupName="Selection" RenderOptions.BitmapScalingMode="NearestNeighbor" />
			</StackPanel>
		</ScrollViewer>

		<Button Grid.Row="3" Height="40" Margin="10" Content="Export Image" Focusable="False" Click="SaveImage" />

		<Border Grid.Column="1" Grid.Row="1" Grid.RowSpan="3" BorderThickness="1,0,0,0" BorderBrush="Black" MouseLeftButtonUp="Border_MouseLeftButtonUp" MouseLeftButtonDown="Border_MouseLeftButtonDown" MouseMove="Border_MouseMove" ClipToBounds="True">
			<local:ZoomControl x:Name="Zoom" Background="Black" ChildWidth="{Binding BackgroundImage.Width}" ChildHeight="{Binding BackgroundImage.Height}">
				<local:ZoomControl.Child>
					<Grid DataContext="{Binding RelativeSource={RelativeSource AncestorType={x:Type Window}}, Path=DataContext}">
						<Canvas>
							<Image  Width="{Binding BackgroundImage.Width}" Height="{Binding BackgroundImage.Height}" Source="{Binding BackgroundImage.BitmapImage}" RenderOptions.BitmapScalingMode="NearestNeighbor" SnapsToDevicePixels="True" />
						</Canvas>

						<ItemsControl ItemsSource="{Binding Elements}" SnapsToDevicePixels="True">
							<ItemsControl.ItemsPanel>
								<ItemsPanelTemplate>
									<Canvas />
								</ItemsPanelTemplate>
							</ItemsControl.ItemsPanel>
							<ItemsControl.ItemTemplate>
								<DataTemplate>
									<Canvas Width="{Binding Width}" Height="{Binding Height}" ClipToBounds="False">
										<Canvas.RenderTransform>
											<TranslateTransform X="{Binding  X}" Y="{Binding Y}" />
										</Canvas.RenderTransform>
										<Image Source="{Binding Image}" Width="{Binding Width}" Height="{Binding Height}" RenderOptions.BitmapScalingMode="NearestNeighbor" SnapsToDevicePixels="True" />
										<Border Width="{Binding Width, Converter={StaticResource AddOne}}" Height="{Binding Height, Converter={StaticResource AddOne }}" BorderThickness="1" BorderBrush="{Binding IsSelected, Converter={StaticResource BoolToBrushConverter}}">
											<Border.RenderTransform>
												<TranslateTransform X="-1" Y="-1" />
											</Border.RenderTransform>
										</Border>
									</Canvas>
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ItemsControl>
					</Grid>
				</local:ZoomControl.Child>
			</local:ZoomControl>
		</Border>
	</Grid>
</Window>